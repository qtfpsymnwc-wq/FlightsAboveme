<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FlightWall – Airline Logo Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0b1220;--panel:#111a2e;--card:#16213a;--accent:#3b82f6;--fallback:#f59e0b;--text:#e5e7eb;--muted:#9ca3af;}
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:16px;border-bottom:1px solid rgba(255,255,255,.08);background:rgba(11,18,32,.7);position:sticky;top:0;backdrop-filter:blur(10px)}
    h1{margin:0;font-size:18px}
    p{margin:8px 0 0;color:var(--muted);font-size:13px;line-height:1.45}
    main{padding:14px;max-width:1100px;margin:0 auto}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0}
    input{background:#0c162b;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px;color:var(--text);min-width:260px}
    button{background:rgba(59,130,246,.15);border:1px solid rgba(59,130,246,.35);color:var(--text);padding:10px 12px;border-radius:12px;font-weight:800}
    .stats{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0)),var(--card);
      border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:12px;display:flex;gap:10px;align-items:center}
    .logo{width:42px;height:42px;border-radius:12px;background:#0c162b;border:1px solid rgba(255,255,255,.1);padding:6px;object-fit:contain}
    .meta{min-width:0}
    .code{font-weight:900;letter-spacing:.6px}
    .tag{font-size:11px;color:var(--muted);margin-top:2px}
    a{color:var(--accent);text-decoration:none}
    .warn{color:var(--fallback);font-weight:800}
  </style>
</head>
<body>
<header>
  <h1>Airline Logo Test</h1>
  <p>
    This page loads logo assets from <code>/assets/logos/&lt;ICAO&gt;.*</code> then falls back to <code>_GENERIC.svg</code>.
    Use it to confirm your logo filenames and formats are correct.
  </p>
</header>

<main>
  <div class="bar">
    <input id="codes" placeholder="Enter ICAO codes, comma-separated (e.g., AAL, DAL, UAL)" />
    <button id="run">Test</button>
    <div class="stats" id="stats">—</div>
  </div>

  <div class="grid" id="grid"></div>

  <p class="stats" style="margin-top:14px">
    Tip: iOS Safari caches aggressively. If a logo looks unchanged, open this page in a new tab.
  </p>
</main>

<script>
  const DEFAULT = ["AAL","DAL","UAL","SWA","ASA","JBU","FFT","NKS","AAY","EDV","ENY","FDX","UPS","SKW","RPA","JIA","GJS"];

  function parseCodes(raw){
    const list = (raw || "").split(",").map(s => s.trim().toUpperCase()).filter(Boolean);
    return list.length ? list : DEFAULT;
  }

  function tryLoad(img, urls, onOk, onFail){
    let i = 0;
    const next = () => {
      if (i >= urls.length){
        onFail && onFail();
        return;
      }
      const url = urls[i++];
      img.onload = () => onOk && onOk(url);
      img.onerror = () => next();
      img.src = url;
    };
    next();
  }

  function render(codes){
    const grid = document.getElementById("grid");
    grid.innerHTML = "";
    let ok = 0, bad = 0;

    for (const icao of codes){
      const card = document.createElement("div");
      card.className = "card";

      const img = document.createElement("img");
      img.className = "logo";
      img.alt = `${icao} logo`;

      const meta = document.createElement("div");
      meta.className = "meta";

      const code = document.createElement("div");
      code.className = "code";
      code.textContent = icao;

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.id = `tag-${icao}`;
      tag.textContent = "loading…";

      const src = document.createElement("a");
      src.className = "tag";
      src.id = `src-${icao}`;
      src.textContent = "";
      src.href = "#";
      src.target = "_blank";

      meta.appendChild(code);
      meta.appendChild(tag);
      meta.appendChild(src);

      card.appendChild(img);
      card.appendChild(meta);
      grid.appendChild(card);

      const candidates = [
        `/assets/logos/${icao}.png`,
        `/assets/logos/${icao}.svg`,
        `/assets/logos/${icao}.webp`
      ];

      tryLoad(
        img,
        candidates,
        (usedUrl) => {
          ok++;
          document.getElementById(`tag-${icao}`).textContent = usedUrl.endsWith(".svg") ? "vendor(svg)" : "vendor(bitmap)";
          const a = document.getElementById(`src-${icao}`);
          a.textContent = usedUrl.split("/").pop();
          a.href = usedUrl;
          updateStats();
        },
        () => {
          bad++;
          img.src = `/assets/logos/_GENERIC.svg`;
          const t = document.getElementById(`tag-${icao}`);
          t.innerHTML = `<span class="warn">missing</span> – using _GENERIC.svg`;
          const a = document.getElementById(`src-${icao}`);
          a.textContent = `_GENERIC.svg`;
          a.href = `/assets/logos/_GENERIC.svg`;
          updateStats();
        }
      );
    }

    function updateStats(){
      document.getElementById("stats").textContent = `OK: ${ok}  •  Missing: ${bad}`;
    }
    updateStats();
  }

  document.getElementById("run").addEventListener("click", () => {
    render(parseCodes(document.getElementById("codes").value));
  });

  // initial render
  render(DEFAULT);
</script>
</body>
</html>